<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudoko</title>
    <script src="https://kit.fontawesome.com/b99e675b6e.js"></script> 	

    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="card">

        <h1 class="title">
            Welcome to Sudoku

        </h1>
        <span>
        <label for="name">Your name</label>
       <input type="text" name="name" id="name" >
        </span>
       <button type="submit" id="bt" onclick="btn_func()"> <i class="fas fa-check"></i> Valider</button>
    </div>
    <div class="main" style="display: none;">  
        
        <div class="submenu">
 <h1>SUDOKU</h1>
    
           
 <p class="time">00:00:00</p>   
 
 <button id="bt" type="submit" onclick="clear_func()"><i class="fas fa-eraser"></i> clear </button>

 <button id="bt" onclick="reload_win()"> <i class="fas fa-redo" ></i></button>
    </div>
    
    <table>
       <tr>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
       </tr>
       <tr>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
       </tr>
       <tr>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
       </tr>
       <tr>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
       </tr>
       <tr>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
       </tr>
       <tr>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
       </tr>
       <tr>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
       </tr>
       <tr>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()" ></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
       </tr>
       <tr>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()"></td>
           <td contenteditable="true" onkeyup="myfunction()" ></td>
       </tr>
<audio src="pl.mp3" loop></audio>
    </div>
 
    </table>

</body>
</html>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="script.js"></script>
<script>
function reload_win (){

location.reload();

}

function clear_func(){


    for(i=0;i<81;i++){

    if(generated_tab.indexOf(i)==-1){

        $("td").eq(i).text("");

    }

    }


    }



var st="";
let matrix2=[];
for(var i=0; i<9; i++) {
    matrix2[i] = [];
    for(var j=0; j<9; j++) {
        matrix2[i][j] =" ";
    }
}
var tab_repeat=[];
var generated_tab=[];
function btn_func(){

 st=$("#name").val();
 if(st.length>=3){
alert("Bienvenue "+st);
    $("#card").toggle(700);
    $(".main").toggle(700);
//    $("body").css("background","none");
   $('audio')[0].play();

   obj= JSON.parse(localStorage.getItem('myJavaScriptObject'));
   if(!obj){
var obj={
    "name":"robot",
    "score":"00:20:10"
}

localStorage.setItem('myJavaScriptObject', JSON.stringify(obj));
}
$('.submenu').append("<p>"+"meilleure score : <br>"+obj["name"]+"   "+obj["score"]+"</p>");


/*  choosing random elements to fill the matrix */
let nb="";
let val="";
let tab=[];
/* first element */
nb =Math.floor(Math.random() * Math.floor(81));

val=Math.floor(Math.random() * Math.floor(9));
while(tab.indexOf(val)!=-1){
    val=Math.floor(Math.random() * Math.floor(9));

}
tab.push(val);
$('td').eq(nb).text(val);
$('td').eq(nb).attr("contenteditable","false");
$('td').eq(nb).css('color','blue');
generated_tab.push(nb);



/* second element */
nb =Math.floor(Math.random() * Math.floor(81));
val=Math.floor(Math.random() * Math.floor(9));
while(tab.indexOf(val)!=-1){
    val=Math.floor(Math.random() * Math.floor(9));

}
tab.push(val);
$('td').eq(nb).text(val);
$('td').eq(nb).attr("contenteditable","false");
$('td').eq(nb).css('color','blue');
generated_tab.push(nb);

/* third elemnt */

nb =Math.floor(Math.random() * Math.floor(81));
val=Math.floor(Math.random() * Math.floor(9));
while(tab.indexOf(val)!=-1){
    val=Math.floor(Math.random() * Math.floor(9));

}
tab.push(val);
$('td').eq(nb).text(val);
$('td').eq(nb).attr("contenteditable","false");
$('td').eq(nb).css('color','blue');
generated_tab.push(nb);



/* forth element */
nb =Math.floor(Math.random() * Math.floor(81));
val=Math.floor(Math.random() * Math.floor(9));
while(tab.indexOf(val)!=-1){
    val=Math.floor(Math.random() * Math.floor(9));

}
tab.push(val);
$('td').eq(nb).text(val);
$('td').eq(nb).attr("contenteditable","false");
$('td').eq(nb).css('color','blue');
generated_tab.push(nb);



/* last element */

nb =Math.floor(Math.random() * Math.floor(81));
val=Math.floor(Math.random() * Math.floor(9));
while(tab.indexOf(val)!=-1){
    val=Math.floor(Math.random() * Math.floor(9));

}
tab.push(val);
$('td').eq(nb).text(val);
$('td').eq(nb).attr("contenteditable","false");
$('td').eq(nb).css('color','blue');
generated_tab.push(nb);
/* the end of choosing elemnts  */

}else{
    alert("veuillez saisire un nom correcte");
}

} 

function char_is_correct(chaine){

   for(i=1;i<=9;i++){
       if(i.toString()==chaine){
           return true;
       }
   }
   return false;
}



    function myfunction(){


        var win=false;

        var matrix = [];
     var tab=[];   
     var m;
    for(var i=0; i<9; i++) {
    matrix[i] = [];
    for(var j=0; j<9; j++) {
        matrix[i][j] =" ";
    }
}
        $('td').each(function () {
    var p=this.innerText;
    tab.push(p);
    
        });
        for(i=0;i<9;i++){
           for(j=0;j<9;j++){
               m=tab.shift();
              
               matrix[i][j]=m;
         
         
          }}
          matrix2=matrix;
          console.log(matrix2);
          if(is_repeated_all_lines(matrix)==false && is_full(matrix)){

            obj= JSON.parse(localStorage.getItem('myJavaScriptObject'));
            var record=obj["score"].split(":");
            var v=$('.time').text();
            var tab=v.split(':'); 

            if(parseInt(tab[1])<record[1]){
                alert("Bravo vous avez battu le meilleur record !");
                var obj2 ={
        "name": st,
        "score": v,
       
    };
    localStorage.setItem('myJavaScriptObject', JSON.stringify(obj2));
    
    var r=  confirm("voulez vous jouer une autre partie");

         if(r==true){
             location.reload();
         }
         else
         {
             window.close();
         }        
           }
         else
         {
              alert("Vous avez gagné!");
         var r=  confirm("voulez vous jouer une autre partie");
         if(r==true)
         {
             location.reload();
         }
         else
         {
             window.close();
         }
            }
              
          }
         

          
         
       
    }

    function is_repeated_all_lines(matrix){
        for(i=0;i<9;i++){
            if(is_repeated(i,matrix)==true){

                return true;

                }
            }
            return false;
    }

        function is_repeated(index,matrix){
            let count=0,j=0;
            for(i=0;i<9;i++){
               let nb= matrix[index][i];
               count =0;
               j=0;
              while(j<9){
                if(matrix[index][j]==nb && nb!=""){
                    count++;
                }
                
                
                if(count>1){
                    return true;
                }
                j++;
              }

            }
            count =0;
               j=0;
               for(i=0;i<9;i++){
               let nb= matrix[i][index];
               if(char_is_correct(nb)==false){
                   return true;
               }
               count =0;
               j=0;
              while(j<9){
                if(matrix[j][index]==nb && nb!=""){
                    count++;
                }
                
                
                if(count>1){
                    return true;
                }
                j++;
              }

            }

            return false;

        }

        

        function is_full(matrix){
            for(i=0;i<9;i++){
                for(j=0;j<9;j++){
                    if(matrix[i][j]==""){
                        return false;
                    }
                }
            }
        return true;
        }
                
        
        function convert_index(i,j){

return (i*10+j-i);
}

function reverse_index(nb){

let tab=[];

tab[0]=Math.trunc(nb/9);
tab[1]=nb%9;
return tab;

}


        function  change_repated_color(index,matrix){
        
        


        
            let count=0;
            let i=0;
            while(i<9){

                let nb=matrix[index][i];
                count=0;
                let current= convert_index(index,i);
                for(j=0;j<9;j++){
                    if(j!=i && nb==matrix[index][j]  && nb!=""){
                        count++;

                      

                    } 
                    
                    }   

                    let modulo=current%9;

                    let min_tab=[];
                        for(k=0;k<81;k++){

                            min_tab=reverse_index(k);
                   
                            if(k%9==modulo && matrix[min_tab[0]][min_tab[1]]==nb && nb!="" && k!=current){
                                    


                                    count++;


                                
                            }
                        }

                    if(count>0){
                        if(tab_repeat.indexOf(current)==-1){
                            tab_repeat.push(current);
                        }
                    }else{
                        if(tab_repeat.indexOf(current)!=-1){
                        
                        tab_repeat.splice(tab_repeat.indexOf(current),1);
                        }
                    }


                i++;
            }
            i=0;
            count=0;

        


        }


    $(document).ready(function(){
         
    
          window.setInterval(function(){
            var v=$('.time').text();
            var tab=v.split(':'); 
            if(parseInt(tab[2])<60){
                tab[2]=parseInt(tab[2])+1;
            }else{
                tab[2]=0;
                if(parseInt(tab[1])<60){
                    tab[1]=parseInt(tab[1])+1;
                    
                }else{
                    tab[1]=0;
                    tab[0]=parseInt(tab[0])+1;
                }
            }
            var final=tab.join(':');
            $('.time').text(final);



            
        
          },1000);
          

          window.setInterval(function(){

          $('td').each(function () {

                var p=this.innerText;
                if(char_is_correct(p)==false && p!=""){
                  
                  this.innerText="";
                
                }

          }   ); 


         for(i=0;i<9;i++){

              change_repated_color(i,matrix2);
          }
          for(i=0;i<81;i++){

              if(tab_repeat.indexOf(i)!=-1 && generated_tab.indexOf(i)==-1){

                  $('td').eq(i).css('color','red');
              }else if(generated_tab.indexOf(i)==-1){

                $('td').eq(i).css("color","black");

              }
          }


          
          
          
          },200);  

        });  

          
    </script>
